<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>缓冲</title>
    <style type="text/css" media="screen">
        html, body
        {
            height: 100%;
        }
        body
        {
            margin: 0;
            padding: 0;
            overflow: auto;
            text-align: center;
            background-color: #ffffff;
        }
    </style>
    
</head>
<body>
    <div style="position: absolute; top: 0px; z-index: 10001">
        <label>点击绘图绘制被缓冲图形，输入缓冲距离，默认单位为米，点击缓冲得到缓冲结果图形；点击“Graphic缓冲”是通过传入的Graphic图形缓冲图形，并直接获取缓冲结果</label>
    </div>
    <div style="position: absolute; top: 40px; left: 100px; background-color: #BEBE9A;
        padding: 2px; z-index: 10000">
          <label for="distances"  >绘制要缓冲的图形：</label>
          <button onclick="drawPolygon()">绘图</button>
          <label for="distance"  >缓冲距离(m)：</label>
          <input type="text" id="distance" value="20000"/>
          <button onclick="buffer()">缓冲</button>
          <button onclick="bufferByGraphic()">Graphic缓冲</button>
    </div>
    <div id="flashContent" style="width: 100%; height: 100%; position: absolute"  />
</body>
<script type="text/javascript" src="http://192.168.5.150:8585/HorseMap/API-2.0/MapAPI.js"></script>
<script type="text/javascript">

    var hmap;
    
    function creatHMap() {
        //初始化地图
        hmap = new HMap("flashContent", "2pZ9e1qhM2Q1LjE1MDo4NTg1LDIxMS45OS4xMzIuMTYyOjg1ODUsbG9jYWxob3N0LDIwMTQtMi0yNix0aW1lMg==");
        //添加底图
        hmap.addBaseMap([new HMap.TiledLayer("http://192.168.5.150/ArcGIS/rest/services/horseMap/chinaMap_terrain/MapServer")]);
        //设置地图显示范围
        hmap.extentTo(70.3589943496297, 16.7574780802653, 138.169212649724, 57.9474199191781);
    }
    //按Graphic缓冲
    function bufferByGraphic() {
        var extentGra = new HMap.ExtentGraphic(100, 33, 110, 38, { fillColor: 0xff0000, data: "addExtentGra!" });
        hmap.addGraphic([extentGra]);
        var geomtryServerUrl = "http://192.168.5.150/ArcGIS/rest/services/Geometry/GeometryServer";
        toolBuffer = new HMap.Buffer(geomtryServerUrl, [extentGra], [distance.value], onResult, { unit: HMap.BUFFER_METER, onFault: onFault });
        hmap.useTool(toolBuffer);
    }
    
    //缓冲
    function buffer() {
        var geomtryServerUrl = "http://192.168.5.150/ArcGIS/rest/services/Geometry/GeometryServer";
        toolBuffer = new HMap.Buffer(geomtryServerUrl, [drawResult], [distance.value], onResult, { unit: HMap.BUFFER_METER, onFault: onFault });
        hmap.useTool(toolBuffer);
    }
    
    //绘制面状图形
    function drawPolygon() {
        drawId = hmap.addDraw(new HMap.DrawPolygon(1, drawCompleted, { showTime: -1 }));
    }
    function drawCompleted(e) {
        drawResult = e.result[0];
    }

    function onResult(e) {
        var result = e.result;
        var graphicArr = new Array();
        for (var i = 0; i < result.length; i++) {
            var graphic;
            graphic = new HMap.PolygonGraphic(result[i].Geometry.rings);
            graphicArr.push(graphic);
        }
        graLayerId = hmap.addGraphic(graphicArr);
    }
    function onFault(e) {
        alert(e.error);
    }

    creatHMap();

</script>
</html>
